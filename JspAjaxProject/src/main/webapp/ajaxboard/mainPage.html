<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link href="https://fonts.googleapis.com/css2?family=Dongle&family=Gamja+Flower&family=Nanum+Myeongjo&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<title>Insert title here</title>
<style type="text/css">
  div.list,div.detail{
    position: absolute;
    left: 100px;
    top: 100px;
    width: 800px;
  }
  div.updateform{
     position: absolute;
    left: 100px;
    top: 100px;
    width: 400px;
  }
  
  div.addform{
     position: absolute;
    left: 1000px;
    top: 100px;
    width: 400px;
  }
  
  div.list *,div addform *,div.detail *,div.updateform *{
    font-family: 'Nanum Myeongjo';
  }
  span.detail{
    cursor: pointer;
  }
  span.day{
    float: right;
    color: gray;
  }
  
  div.detail button{
    width: 80px;
    margin-right: 10px;
  }
</style>
<script type="text/javascript">
  $(function(){
	  
	  $("div.updateform").hide(); //수정폼이 처음에 안보이게
	  list();
	  
	  //처음에 입력폼 안보이게
	  $("div.addform").hide();
	  //글쓰기버튼 누르면 나오게
	  $("#btnadd").click(function(){
		   $("div.addform").toggle(); //show+hide
		   
	  });
	  
	  //db추가버튼 눌러서 서버에 저장
	  $("#dbsave").click(function(){
		  
		  //폼의 id가 있고 각컬럼에 name이 있을경우
		  //var data=$("#addfrm").serialize();
		  //alert(data);
		  var writer=$("#writer").val();
		  var subject=$("#subject").val();
		  var content=$("#content").val();
		  var avata=$("#avata").val();
		  
		  //console.log(writer,subject,content,avata);
		  //각각의 id로 데이타를 넘길때
		  //var data="writer="+writer+"&subject="+subject+"&content="+content+"&avata="+avata;
		  //alert(data);
		  
		  $.ajax({
			  type:"post",
			  dataType:"html",
			  url:"boardInsert.jsp",
			  data:{"writer":writer,"subject":subject,"content":content,"avata":avata},
			  success:function(){
				  
				  //alert("성공!!");
				  //insert성공시 처리할것들
				  $("#writer").val('');
				  $("#subject").val('');
				  $("#content").val('');
				  
				  //다시출력
				  list();
				  //입력폼사라지게..
				  $("div.addform").hide();
				  
			  }
		  })
		  
		  
	  });
	  
	  
	  //제목클릭시 리스트 숨기고 디테일 나타나게 하기
	  $(document).on("click","span.detail",function(){
		  
		  //span태그에 넣어둔 num가져오기
		  var num=$(this).attr("num");
		  //alert(num);
		  
		  $.ajax({
			  type:"get",
			  dataType:"json",
			  url:"boardDetail.jsp",
			  data:{"num":num},
			  success:function(res){
				  
				  var s="<table class='table table-bordered'>";
				  s+="<tr>";
				  s+="<td><b style='font-size:2em;'>"+res.subject+"</b>";
				  s+="<span class='day'>"+res.writeday+"</span>";
				  s+="<br>"+res.writer+"</td></tr>";
				  s+="<tr height='250'><td>";
				  s+="<img src='"+res.avata+"' hspace='50' align='left'>";
				  s+="<pre>"+res.content+"</pre></td></tr>";
				  s+="<tr><td align='right'>";
				  s+="<button type='button' class='btn btn-outline-info btnlist'>목록</button>";
				  s+="<button type='button' class='btn btn-outline-info btnupdate' num="+res.num+">수정</button>";
				  s+="<button type='button' class='btn btn-outline-info btndel' num="+res.num+">삭제</button>";
				  s+="</td></tr></table>";
				  $("div.detail").html(s);
				  
				  //list숨기기
				  $("div.list").hide();
				  //detail페이지 보이게
				  $("div.detail").show();
			  }
		  })
	  });
	  
	  //디테일의 목록버튼 누르면 디테일 사라지고 리스트 나오고~~~
	  $(document).on("click",".btnlist",function(){
		  
		  $("div.detail").hide();
		  $("div.list").show();
	  });
	  
	  //삭제
	  $(document).on("click",".btndel",function(){
		  
		  var num=$(this).attr("num");
		  //alert(num);
		  
		  $.ajax({
			  type:"get",
			  dataType:"html",
			  url:"boardDelete.jsp",
			  data:{"num":num},
			  success:function(){
				  
				  list(); //목록 다시호출
				  
				  //내용보기 사라지게
				  $("div.detail").hide();
				  //목록 보이게
				  $("div.list").show();
			  }
		  })
	  });
	  
	  
	  //수정버튼누르면....수정폼나오고 그안에 dto내용이 value에 담긴다
	  $(document).on("click",".btnupdate",function(){
		  
		  var num=$(this).attr("num");
		  //alert(num);
		  //디테일 페이지에 사용하던 boardDetail.jsp에서 json을얻어서 수정폼에 사용한다
		  //출력해서 value에 해서 수정폼이 보이게...
		  $.ajax({
			  type:"get",
			  dataType:"json",
			  url:"boardDetail.jsp",
			  data:{"num":num},
			  success:function(res){
				  //수정폼에 데이타 넣어주기
				  $("#unum").val(res.num);
				  $("#uwriter").val(res.writer);
				  $("#usubject").val(res.subject);
				  $("#ucontent").val(res.content);
				  $("#uavata").val(res.avata);
				  
				  //디테일페이지 안보이게
				  $("div.detail").hide();
				  //수정폼 보이게
				  $("div.updateform").show();
			  }
		  })
		  
	  });
	  
	  //수정버튼 누르면 수정되서 목록
	  $("#dbupdate").click(function(){
		  
		  var data=$("#updatefrm").serialize();
		  //alert(data);
		  
		  $.ajax({
			  type:"post",
			  dataType:"html",
			  url:"boardUpdate.jsp",
			  data:data,
			  success:function()
			  {
				  //수정했으면 목록 다시 가져오기
				  list();
				  //현재 수정폼 안보이게
				  
				  $("div.updateform").hide();
				  //목록
				  $("div.list").show();
				  //디테일로 하려면 수정된 디테일 다시 불러와야 한다
				  //div.detail은 인서트 된 내용의 디테일이므로 현재수정된 디테일로 하려면
				  //다시 디테일된 내용을 태그로 불러와야한다
				  //$("div.detail").show();
				  
			  }
		  })
	  });
	  
  })
  
  function list()
  {
	  $.ajax({
		  type:"get",
		  dataType:"json",
		  url:"boardList.jsp",
		  success:function(res){
			  //alert(res.length);
			  //제목
			  var s="<table class='table table-bordered'>";
			  s+="<caption align='top'><b>Ajax Board전체목록</b></caption>";
			  s+="<tr class='table-secondary'>";
			  s+="<th width='80'>번호</th>";
			  s+="<th width='380'>제목</th>";
			  s+="<th width='180'>작성자</th>";
			  s+="<th width='200'>작성일</th>";
			  s+="</tr>";
			  
			  if(res.length==0){
				  s+="<tr>";
				  s+="<td colspan='4' align='center'>";
				  s+="<b>저장된 글이 없습니다</b>";
				  s+="</td></tr>";
			  }else{
				  //데이타가 1개이상 있는경우
				  $.each(res,function(i,ele){
					  s+="<tr>";
					  s+="<td align='center'>"+(i+1)+"</td>";
					  s+="<td>";
					  s+="<span class='detail' num="+ele.num+">"+ele.subject+"</span></td>";
					  s+="<td align='center'>"+ele.writer+"</td>";
					  s+="<td>"+ele.writeday+"</td>"
				  })
			  }
			  
			  s+="</table>";
			  
			  $("#boardlist").html(s);
			  
		  }
	  })
  }
  
</script>
</head>
<body>

<!--리스트와 글쓰기버튼  -->
  <div class="list">
     <button type="button" class="btn btn-success" id="btnadd">글쓰기</button>
     <div id="boardlist"></div>
  </div>
 
 <!-- 디테일페이지 --> 
 <div class="detail"></div>
  
<!-- 입력폼 -->
  <div class="addform">
      <form id="addfrm">
        <table class="table table-bordered">
          <caption align="top"><b>게시글 작성</b></caption>
           <tr>
             <th width="100" class="table-success">작성자</th>
             <td>
               <input type="text" class="form-control"
               name="writer" id="writer" style="width: 120px;">
             </td>
           </tr>
           <tr>
             <th width="100" class="table-success">제목</th>
             <td>
               <input type="text" class="form-control"
               name="subject" id="subject" style="width: 120px;">
             </td>
           </tr>
           <tr>
             <th width="100" class="table-success">이모티콘</th>
             <td>
                <select id="avata" class="form-control" style="width: 120px;" name="avata">
                  <option value="../image/avata/b1.png">사랑해</option>
                  <option value="../image/avata/b2.png">심심</option>
                  <option value="../image/avata/b3.png">Hi~~</option>
                  <option value="../image/avata/b5.png">배고픔</option>
                  <option value="../image/avata/b6.png">좌절</option>
                  <option value="../image/avata/b7.png">신남</option>
                  <option value="../image/avata/b8.png">최고</option>
                 
                </select>
             </td>
           </tr>
           <tr>
             
             <td colspan="2">
               <textarea style="width: 400px; height: 80px;"
               class="form-control" name="content" id="content"></textarea>
             </td>
           </tr>
           
           <tr>
             <td colspan="2" align="center">
                <button type="button" class="btn btn-secondary"
                id="dbsave">DB에 저장하기</button>
             </td>
           </tr>
        </table>
      </form>
   </div>
   
   <!-- 수정폼 -->
  <div class="updateform">
      <form id="updatefrm">
      <!-- num hidde -->
      <input type="hidden" name="unum" id="unum">
        <table class="table table-bordered">
          <caption align="top"><b>게시글 수정</b></caption>
           <tr>
             <th width="100" class="table-success">작성자</th>
             <td>
               <input type="text" class="form-control"
               name="uwriter" id="uwriter" style="width: 120px;">
             </td>
           </tr>
           <tr>
             <th width="100" class="table-success">제목</th>
             <td>
               <input type="text" class="form-control"
               name="usubject" id="usubject" style="width: 120px;">
             </td>
           </tr>
           <tr>
             <th width="100" class="table-success">이모티콘</th>
             <td>
                <select id="uavata" class="form-control" style="width: 120px;" name="uavata">
                  <option value="../image/avata/b1.png">사랑해</option>
                  <option value="../image/avata/b2.png">심심</option>
                  <option value="../image/avata/b3.png">Hi~~</option>
                  <option value="../image/avata/b5.png">배고픔</option>
                  <option value="../image/avata/b6.png">좌절</option>
                  <option value="../image/avata/b7.png">신남</option>
                  <option value="../image/avata/b8.png">최고</option>
                 
                </select>
             </td>
           </tr>
           <tr>
             
             <td colspan="2">
               <textarea style="width: 400px; height: 80px;"
               class="form-control" name="ucontent" id="ucontent"></textarea>
             </td>
           </tr>
           
           <tr>
             <td colspan="2" align="center">
                <button type="button" class="btn btn-danger"
                id="dbupdate">DB에 수정하기</button>
             </td>
           </tr>
        </table>
      </form>
   </div>
   
</body>
</html>