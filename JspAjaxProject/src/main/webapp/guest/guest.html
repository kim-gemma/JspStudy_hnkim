<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link
	href="https://fonts.googleapis.com/css2?family=Dongle&family=Gamja+Flower&family=Nanum+Myeongjo&family=Nanum+Pen+Script&display=swap"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
	crossorigin="anonymous">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<title>Insert title here</title>
<style type="text/css">
div.guest {
	position: absolute;
	border: 0px solid gray;
	font-family: 'Nanum Pen Script';
	font-size: 1.4em;
}

div.button {
	left: 150px;
	top: 50px;
	width: 500px;
	height: 100px;
	line-height: 100px;
	text-align: center;
}

div.addform, div.updateform {
	left: 100px;
	top: 170px;
	width: 550px;
	height: 400px;
	padding: 20px 20px;
}

div.list {
	left: 800px;
	top: 100px;
	width: 600px;
	height: 800px;
	padding: 20px 20px;
}

img.emot, img.uemot {
	cursor: pointer;
}

img.select {
	border: 3px solid red;
}

span.nick {
	color: red;
}

span.day {
	float: right;
	color: gray;
}
</style>
<script type="text/javascript">
	$(function() {

		//ì²˜ìŒë¡œë“œì‹œ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
		list();

		//ì¶”ê°€í¼ ì—†ë‹¤ê°€ ì¸ì‚¬ë§ ì¶”ê°€ë²„íŠ¼ ëˆ„ë¥´ë©´ ìƒê¸°ê²Œ
		$("div.addform").hide();
		$("div.updateform").hide();

		$("#btnadd").click(function() {
			$("div.updateform").hide();
			$("div.addform").toggle();
			
		});

		//ì´ëª¨í‹°ì½˜ 2ë²ˆì¸ë±ìŠ¤ì— select í´ë˜ìŠ¤ ì¶”ê°€
		$("img.emot").eq(2).addClass("select");

		//ì´ëª¨í‹°ì½˜ 2ë²ˆì˜ ì¸ë±ìŠ¤ì˜ srcê²½ë¡œë¥¼ ì–»ì–´ì„œ inputíƒœê·¸ì— ë„£ì–´ì£¼ê¸°
		$("#emot").val($("img.emot").eq(2).attr("src"));

		//ì´ëª¨í‹°ì½˜ ê°’ ë³€ê²½í•˜ê¸°
		$("img.emot").click(function() {

			//í´ë¦­ì•ˆí•œ í˜•ì œíƒœê·¸ selectì§€ìš°ê¸°
			$(this).siblings().removeClass("select");
			//í˜„ì¬í´ë¦­í•œ ê³³ select
			$(this).addClass("select");
			//í˜„ì¬í´ë¦­í•œ ì´ë¯¸ì§€ê²½ë¡œë¥¼ inputì— ê²½ë¡œë¡œ ë³€ê²½í•´ì£¼ê¸°
			$("#emot").val($(this).attr("src"));
		});

		//ì €ì¥..post
		$("#dbsave").click(function() {

			var data = $("#addfrm").serialize();
			//alert(data);

			$.ajax({
				type : "post",
				dataType : "html",
				url : "guestInsert.jsp",
				data : data,
				success : function() {
					alert("ì…ë ¥ì„±ê³µ");
					//ì¶”ê°€ê°€ ì„±ê³µí–ˆë‹¤ë©´ list()í˜¸ì¶œ
					//list();

					//ì…ë ¥ê°’ ì´ˆê¸°í™”
					$("#nickname").val('');
					$("#content").val('');

					//ì´ëª¨í‹°ì½˜ ì´ˆê¸°í™”
					$("img.emot").removeClass("select"); //ì„ íƒí•œ ì´ëª¨í‹°ì½˜ í´ë˜ìŠ¤ ì§€ìš°ê¸°
					//ì´ëª¨í‹°ì½˜ 2ë²ˆì¸ë±ìŠ¤ì— select í´ë˜ìŠ¤ ì¶”ê°€
					$("img.emot").eq(2).addClass("select");

					//ì´ëª¨í‹°ì½˜ 2ë²ˆì˜ ì¸ë±ìŠ¤ì˜ srcê²½ë¡œë¥¼ ì–»ì–´ì„œ inputíƒœê·¸ì— ë„£ì–´ì£¼ê¸°
					$("#emot").val($("img.emot").eq(2).attr("src"));

				}
			})
		});

		//ì‚­ì œ ë™ì  ë©”ì„œë“œ
		$(document).on("click", "i.del", function() {
			var num = $(this).attr("num");
			//alert(num);
			$.ajax({
				type : "get",
				dataType : "html",
				url : "guestDelete.jsp",
				data : {
					"num" : num
				},
				success : function() {
					//ëª©ë¡ë‹¤ì‹œì¶œë ¥
					list();
				}

			})
		});

	})

	$(document).on("click", "img.uemot", function() {

		$("img.uemot").removeClass("select"); // ê¸°ì¡´ ì„ íƒ ì œê±°
		$(this).addClass("select"); // í˜„ì¬ ì„ íƒ

		// hidden inputì— ì„ íƒí•œ ì´ë¯¸ì§€ ê²½ë¡œ ì €ì¥
		$("#uemot").val($(this).attr("src"));
	});

	//ìˆ˜ì •í¼ì„ ë„ìš°ê¸°
	$(document).on("click", "i.mode", function() {
		var num = $(this).attr("num");
		// alert(num);
		//ìˆ˜ì •í¼ì˜ unumì˜ numì„ ë„£ê¸°
		$("#unum").val(num);

		$.ajax({
			type : "get",
			url : "guestOneData.jsp",
			data : {
				"num" : num
			},
			dataType : "json",
			success : function(data) {

				// ìˆ˜ì •í¼ì— ê°’ ì±„ìš°ê¸°
				$("#unum").val(data.num);
				$("#unickname").val(data.nick);
				$("#ucontent").val(data.content);
				$("#uemot").val(data.emot);
				// ì´ëª¨í‹°ì½˜ ì„ íƒ í‘œì‹œ
				$("img.uemot").removeClass("select");
				$("img.uemot").each(function() {
					if ($(this).attr("src") === data.emot) {
						$(this).addClass("select");
					}
				});
				// ìˆ˜ì •í¼ ë³´ì´ê¸°
				$("div.addform").hide();
				$("div.updateform").show();

			}
		})

		//ìˆ˜ì •..post
		$("#dbupdate").click(function() {

			var data = $("#updatefrm").serialize();
			//alert(data);

			$.ajax({
				type : "post",
				dataType : "html",
				url : "guestUpdate.jsp",
				data : data,
				success: function() {
				  //alert("ìˆ˜ì •ì„±ê³µ");
				  list();
				  $("div.updateform").hide();
				}
			})
		});
	})

	function list() {//AJAXë¡œ JSON ë°›ì•„ì„œ í™”ë©´ì— ë¿Œë¦¬ëŠ” ì „í˜•ì ì¸ íŒ¨í„´-ì„œë²„ì—ì„œ ë°©ëª…ë¡ JSON ëª©ë¡ì„ ê°€ì ¸ì™€ì„œHTML ë¬¸ìì—´ë¡œ ë§Œë“¤ì–´ div.list ì•ˆì— ì¶œë ¥í•˜ëŠ” í•¨ìˆ˜
		$
				.ajax({
					type : "get", //ì¡°íšŒëŠ” getë°©ì‹ , DB select â†’ get ë°©ì‹ì´ ê´€ë¡€
					dataType : "json",
					url : "guestList.jsp",
					//ìš”ì²­ì„ ë³´ë‚¼ ì„œë²„ ì£¼ì†Œ JSON ë§Œë“¤ì–´ì£¼ëŠ” JSP
					//ìš°ë¦¬ê°€ ì•„ê¹Œ ë§Œë“  ì´ê±°ë‘ ì—°ê²°ë¨: <%= arr.toString() %>

					//íŒŒë¼ë¯¸í„° ê°’ì´ ì—†ë‹¤ëŠ”ê²ƒ ë°ì´í„° ê°’ì´ ì—†ë‹¤ëŠ”ê±° list dto ê·¸ëƒ¥ â€œëª©ë¡ ì¤˜â€ ìš”ì²­ë§Œ í•˜ëŠ” ìƒí™©
					success : function(data) {
						//alert(data.length);
						var s = "";
						if (data.length == 0) {
							s += "<h4 class='alert alert-success'>ë°©ë¬¸ê°ì´ ì—†ìŠµë‹ˆë‹¤.</h4>"
						} else {
							//ë„˜ì–´ì˜¤ëŠ” ë°ì–´í„° ë°°ì—´ëª…ìœ¼ë¡œ ë„˜ì–´ì˜´? data â†’ JSON ë°°ì—´ elt â†’ ë°°ì—´ ì•ˆì˜ ë°©ëª…ë¡ 1ê°œ ê°ì²´	 
							//elt.nickelt.content elt.emot elt.writeday
							//â¬†ï¸ ì´ê²Œ ê°€ëŠ¥í•œ ì´ìœ ëŠ”ğŸ‘‰ JSPì—ì„œ JSON keyë¥¼ ì´ë ‡ê²Œ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸
							//jsp
							//ob.put("nick", dto.getNickname());
							//ob.put("content", dto.getContent());
							$
									.each(
											data,
											function(i, elt) {
												s += "<i class='bi bi-pen mode' num="+elt.num+"></i>";
												s += "<i class='bi bi-trash del' num="+elt.num+"></i>";
												s += "<table class='table table-bordered'>";
												s += "<tr height='100'><td>";
												s += "<span class='nick'>ì‘ì„±ì:"
														+ elt.nick + "</span>";
												s += "<span class='day'>ì‘ì„±ì¼:"
														+ elt.writeday
														+ "</span>";
												s += "<br>";
												s += "<pre>" + elt.content;
												s += "<img src='"+elt.emot+"' width='80' align='right'></pre>";
												s += "</td></tr></table>";

											});
						}

						$("div.list").html(s);
						/*
						list() í˜¸ì¶œ
						â†“
						AJAX â†’ guestList.jsp ìš”ì²­
						â†“
						JSPì—ì„œ JSON ë°°ì—´ ìƒì„±
						â†“
						JSON â†’ dataë¡œ ì „ë‹¬ 
						â†“
						$.eachë¡œ HTML ìƒì„±
						â†“
						div.listì— ì¶œë ¥
						 */

					}
				})
	}
</script>
</head>
<body>
	<div class="guest button">
		<button type="button" class="btn btn-danger" id="btnadd">ì¸ì‚¬ë§ì¶”ê°€</button>
	</div>

	<div class="guest addform">
		<form id="addfrm">
			<table class="table table-bordered">
				<caption align="top">
					<b>ì¸ì‚¬ë§ ë‚¨ê¸°ê¸°</b>
				</caption>
				<tr>
					<th width="100" class="table-success">ì‘ì„±ì</th>
					<td><input type="text" class="form-control" name="nickname"
						id="nickname" style="width: 120px;"></td>
				</tr>
				<tr>
					<th width="100" class="table-success">ì¸ì‚¬ë§</th>
					<td><textarea style="width: 400px; height: 80px;"
							class="form-control" name="content" id="content"></textarea></td>
				</tr>
				<tr>
					<th width="100" class="table-success">ì´ëª¨í‹°ì½˜</th>
					<td><input type="hidden" name="emot" id="emot"> <script
							type="text/javascript">
						/* b1~b10.pngê¹Œì§€ */
						var s = "";
						for (var i = 1; i <= 10; i++) {
							s += "<img src='../image/avata/b"+i+".png' width='40' class='emot'>";

						}
						document.write(s);
					</script></td>
				</tr>
				<tr>
					<td colspan="2" align="center">
						<button type="button" class="btn btn-secondary" id="dbsave">DBì—
							ì €ì¥í•˜ê¸°</button>
					</td>
				</tr>
			</table>
		</form>
	</div>


	<div class="guest updateform">
		<form id="updatefrm">
			<input type="hidden" name="unum" id="unum">
			<table class="table table-bordered">
				<caption align="top">
					<b>ì¸ì‚¬ë§ ìˆ˜ì •</b>
				</caption>
				<tr>
					<th width="100" class="table-success">ì‘ì„±ì</th>
					<td><input type="text" class="form-control" name="unickname"
						id="unickname" style="width: 120px;"></td>
				</tr>
				<tr>
					<th width="100" class="table-success">ì¸ì‚¬ë§</th>
					<td><textarea style="width: 400px; height: 80px;"
							class="form-control" name="ucontent" id="ucontent"></textarea></td>
				</tr>
				<tr>
					<th width="100" class="table-success">ì´ëª¨í‹°ì½˜</th>
					<td><input type="hidden" name="uemot" id="uemot"> <script
							type="text/javascript">
						/* b1~b10.pngê¹Œì§€ */
						var s = "";
						for (var i = 1; i <= 10; i++) {
							s += "<img src='../image/avata/b"+i+".png' width='40' class='uemot'>";

						}
						document.write(s);
					</script></td>
				</tr>
				<tr>
					<td colspan="2" align="center">
						<button type="button" class="btn btn-secondary" id="dbupdate">DBì—
							ìˆ˜ì •í•˜ê¸°</button>
					</td>
				</tr>
			</table>
		</form>
	</div>
	<div class="guest list">list</div>

</body>
</html>